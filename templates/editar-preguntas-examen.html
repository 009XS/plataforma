{% extends "base.html" %}
{% block title %}Editar Preguntas | EduPlatform{% endblock %}
{% block content %}
<div class="min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-6">
        <h1 class="text-3xl font-bold mb-8">Editar Preguntas: {{ examen.titulo }}</h1>

        <form action="/editar-preguntas-examen/{{ examen.id }}" method="POST" id="preguntas-form">
            <div id="preguntas-container">
                {% for pregunta in preguntas %}
                <div class="bg-white rounded-xl shadow-sm p-6 mb-4 pregunta-card" data-index="{{ loop.index }}">
                    <div class="flex justify-between items-center mb-4">
                        <span class="font-semibold">Pregunta {{ loop.index }}</span>
                        <button type="button" onclick="eliminarPregunta(this)"
                            class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                    </div>
                    <input type="hidden" name="pregunta_id[]" value="{{ pregunta.id }}">
                    <textarea name="pregunta_texto[]" class="w-full border rounded-lg px-4 py-3 mb-4" rows="2"
                        required>{{ pregunta.texto }}</textarea>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <input type="text" name="opcion_a[]" class="border rounded-lg px-4 py-2" placeholder="Opción A"
                            value="{{ pregunta.opciones[0] if pregunta.opciones else '' }}" required>
                        <input type="text" name="opcion_b[]" class="border rounded-lg px-4 py-2" placeholder="Opción B"
                            value="{{ pregunta.opciones[1] if pregunta.opciones else '' }}" required>
                        <input type="text" name="opcion_c[]" class="border rounded-lg px-4 py-2" placeholder="Opción C"
                            value="{{ pregunta.opciones[2] if pregunta.opciones else '' }}" required>
                        <input type="text" name="opcion_d[]" class="border rounded-lg px-4 py-2" placeholder="Opción D"
                            value="{{ pregunta.opciones[3] if pregunta.opciones else '' }}" required>
                    </div>
                    <select name="respuesta_correcta[]" class="border rounded-lg px-4 py-2" required>
                        <option value="0" {% if pregunta.respuesta_correcta==0 %}selected{% endif %}>A es correcta
                        </option>
                        <option value="1" {% if pregunta.respuesta_correcta==1 %}selected{% endif %}>B es correcta
                        </option>
                        <option value="2" {% if pregunta.respuesta_correcta==2 %}selected{% endif %}>C es correcta
                        </option>
                        <option value="3" {% if pregunta.respuesta_correcta==3 %}selected{% endif %}>D es correcta
                        </option>
                    </select>
                </div>
                {% endfor %}
            </div>

            <button type="button" onclick="agregarPregunta()"
                class="w-full py-4 border-2 border-dashed rounded-xl text-gray-500 hover:text-brand-600 hover:border-brand-600 mb-6">
                <i class="fas fa-plus mr-2"></i>Agregar Pregunta
            </button>

            <button type="submit"
                class="w-full bg-brand-600 text-white py-3 rounded-lg font-semibold hover:bg-brand-700">
                <i class="fas fa-save mr-2"></i>Guardar Cambios
            </button>
        </form>
    </div>
</div>

<script>
    let preguntaIndex = {{ preguntas| length }};
    function agregarPregunta() {
        preguntaIndex++;
        const html = `<div class="bg-white rounded-xl shadow-sm p-6 mb-4 pregunta-card">
        <div class="flex justify-between items-center mb-4">
            <span class="font-semibold">Pregunta ${preguntaIndex}</span>
            <button type="button" onclick="eliminarPregunta(this)" class="text-red-500"><i class="fas fa-trash"></i></button>
        </div>
        <input type="hidden" name="pregunta_id[]" value="">
        <textarea name="pregunta_texto[]" class="w-full border rounded-lg px-4 py-3 mb-4" rows="2" required></textarea>
        <div class="grid grid-cols-2 gap-4 mb-4">
            <input type="text" name="opcion_a[]" class="border rounded-lg px-4 py-2" placeholder="Opción A" required>
            <input type="text" name="opcion_b[]" class="border rounded-lg px-4 py-2" placeholder="Opción B" required>
            <input type="text" name="opcion_c[]" class="border rounded-lg px-4 py-2" placeholder="Opción C" required>
            <input type="text" name="opcion_d[]" class="border rounded-lg px-4 py-2" placeholder="Opción D" required>
        </div>
        <select name="respuesta_correcta[]" class="border rounded-lg px-4 py-2" required>
            <option value="0">A es correcta</option>
            <option value="1">B es correcta</option>
            <option value="2">C es correcta</option>
            <option value="3">D es correcta</option>
        </select>
    </div>`;
        document.getElementById('preguntas-container').insertAdjacentHTML('beforeend', html);
    }
    function eliminarPregunta(btn) {
        btn.closest('.pregunta-card').remove();
    }
</script>
{% endblock %}